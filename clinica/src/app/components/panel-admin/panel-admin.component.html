<div class="admin-container">
  
  <!-- Header del panel administrativo -->
  <div class="admin-header">
    <div class="header-content">
      <span class="admin-icon">âš•ï¸</span>
      <div class="header-text">
        <h1 class="title">Panel Administrativo</h1>
        <p class="subtitle">GestiÃ³n de usuarios del sistema mÃ©dico</p>
      </div>
    </div>
  </div>

  <!-- Selector de tipo de usuario -->
  <div class="user-type-selector">
    <h2 class="section-title">ğŸ¯ Seleccionar Tipo de Usuario</h2>
    <div class="radio-group">
      <label class="radio-option" [class.active]="crearTipo === 'admin'">
        <input type="radio" name="tipo" value="admin" [(ngModel)]="crearTipo">
        <span class="radio-icon">ğŸ‘¨â€ğŸ’¼</span>
        <span class="radio-text">Administrador</span>
      </label>
      <label class="radio-option" [class.active]="crearTipo === 'empleado'">
        <input type="radio" name="tipo" value="empleado" [(ngModel)]="crearTipo">
        <span class="radio-icon">ğŸ‘¨â€âš•ï¸</span>
        <span class="radio-text">Especialista</span>
      </label>
      <label class="radio-option" [class.active]="crearTipo === 'paciente'">
        <input type="radio" name="tipo" value="paciente" [(ngModel)]="crearTipo">
        <span class="radio-icon">ğŸ‘¤</span>
        <span class="radio-text">Paciente</span>
      </label>
    </div>
  </div>

  <!-- Lista de Administradores -->
  <div class="data-section" *ngIf="administradores.length && crearTipo === 'admin'">
    <div class="section-header">
      <h2 class="section-title">ğŸ‘¨â€ğŸ’¼ Administradores Registrados</h2>
      <span class="count-badge">{{ administradores.length }}</span>
    </div>
    <div class="table-container">
      <table class="medical-table">
        <thead>
          <tr>
            <th>ğŸ‘¤ Nombre</th>
            <th>ğŸ“ Apellido</th>
            <th>ğŸ‚ Edad</th>
            <th>ğŸ†” DNI</th>
            <th>ğŸ“§ Email</th>
            <th>ğŸ“¸ Imagen</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let admin of administradores">
            <td>{{ admin.nombre }}</td>
            <td>{{ admin.apellido }}</td>
            <td>{{ admin.edad }}</td>
            <td>{{ admin.dni }}</td>
            <td class="email-cell">{{ admin.email }}</td>
            <td class="image-cell">
              <img *ngIf="admin.imagenPerfil && admin.imagenPerfil.trim() !== ''" 
                   [src]="admin.imagenPerfil" 
                   alt="Perfil" 
                   class="profile-image"
                   (error)="$event.target.style.display='none'">
              <span *ngIf="!admin.imagenPerfil || admin.imagenPerfil.trim() === ''" class="no-image">ğŸ“·</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Lista de Empleados -->
  <div class="data-section" *ngIf="empleados.length && crearTipo === 'empleado'">
    <div class="section-header">
      <h2 class="section-title">ğŸ‘¨â€âš•ï¸ Especialistas Registrados</h2>
      <span class="count-badge">{{ empleados.length }}</span>
    </div>
    <div class="table-container">
      <table class="medical-table">
        <thead>
          <tr>
            <th>ğŸ‘¤ Nombre</th>
            <th>ğŸ“ Apellido</th>
            <th>ğŸ‚ Edad</th>
            <th>ğŸ†” DNI</th>
            <th>ğŸ©º Especialidad</th>
            <th>ğŸ“§ Email</th>
            <th>ğŸ“¸ Imagen</th>
            <th>âœ… Estado</th>
            <th>âš™ï¸ AcciÃ³n</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let empleado of empleados">
            <td>{{ empleado.nombre }}</td>
            <td>{{ empleado.apellido }}</td>
            <td>{{ empleado.edad }}</td>
            <td>{{ empleado.dni }}</td>
            <td class="specialty-cell">{{ empleado.especialidad }}</td>
            <td class="email-cell">{{ empleado.email }}</td>
            <td class="image-cell">
              <img *ngIf="empleado.imagenPerfil && empleado.imagenPerfil.trim() !== ''" 
                   [src]="empleado.imagenPerfil" 
                   alt="Perfil" 
                   class="profile-image"
                   (error)="$event.target.style.display='none'">
              <span *ngIf="!empleado.imagenPerfil || empleado.imagenPerfil.trim() === ''" class="no-image">ğŸ“·</span>
            </td>
            <td class="status-cell">
              <span class="status-badge" [class.approved]="empleado.aprobado" [class.pending]="!empleado.aprobado">
                {{ empleado.aprobado ? 'âœ… Aprobado' : 'â³ Pendiente' }}
              </span>
            </td>
            <td class="action-cell">
              <button class="action-btn" 
                      [class.approve]="!empleado.aprobado" 
                      [class.reject]="empleado.aprobado"
                      (click)="toggleAprobado(empleado)" 
                      [disabled]="loading">
                <span class="btn-icon">{{ empleado.aprobado ? 'âŒ' : 'âœ…' }}</span>
                <span class="btn-text">{{ empleado.aprobado ? 'Desaprobar' : 'Aprobar' }}</span>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Lista de Pacientes -->
  <div class="data-section" *ngIf="pacientes.length && crearTipo === 'paciente'">
    <div class="section-header">
      <h2 class="section-title">ğŸ‘¤ Pacientes Registrados</h2>
      <span class="count-badge">{{ pacientes.length }}</span>
    </div>
    <div class="table-container">
      <table class="medical-table">
        <thead>
          <tr>
            <th>ğŸ‘¤ Nombre</th>
            <th>ğŸ“ Apellido</th>
            <th>ğŸ†” DNI</th>
            <th>ğŸ“§ Email</th>
            <th>ğŸ¥ Obra Social</th>
            <th>ğŸ“¸ Foto 1</th>
            <th>ğŸ“¸ Foto 2</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let paciente of pacientes">
            <td>{{ paciente.nombre }}</td>
            <td>{{ paciente.apellido }}</td>
            <td>{{ paciente.dni }}</td>
            <td class="email-cell">{{ paciente.email }}</td>
            <td class="insurance-cell">{{ paciente.obraSocial }}</td>
            <td class="image-cell">
              <img *ngIf="paciente.foto1 && paciente.foto1.trim() !== ''" 
                   [src]="paciente.foto1" 
                   alt="Foto 1" 
                   class="patient-image"
                   (error)="$event.target.style.display='none'">
              <span *ngIf="!paciente.foto1 || paciente.foto1.trim() === ''" class="no-image">ğŸ“·</span>
            </td>
            <td class="image-cell">
              <img *ngIf="paciente.foto2 && paciente.foto2.trim() !== ''" 
                   [src]="paciente.foto2" 
                   alt="Foto 2" 
                   class="patient-image"
                   (error)="$event.target.style.display='none'">
              <span *ngIf="!paciente.foto2 || paciente.foto2.trim() === ''" class="no-image">ğŸ“·</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Formulario Nuevo Administrador -->
  <div class="form-section" *ngIf="crearTipo === 'admin'">
    <div class="form-header">
      <h2 class="form-title">ğŸ‘¨â€ğŸ’¼ Crear Nuevo Administrador</h2>
      <p class="form-subtitle">Complete los datos del nuevo administrador del sistema</p>
    </div>
    
    <form [formGroup]="nuevoAdminForm" (ngSubmit)="crearAdmin()" class="medical-form">
      <div class="form-grid">
        <div class="form-group">
          <label for="admin-nombre">ğŸ‘¤ Nombre</label>
          <input 
            id="admin-nombre"
            type="text" 
            formControlName="nombre"
            placeholder="Ingrese el nombre"
            [class.error]="nuevoAdminForm.get('nombre')?.touched && nuevoAdminForm.get('nombre')?.invalid">
          <div class="error-messages" *ngIf="nuevoAdminForm.get('nombre')?.touched && nuevoAdminForm.get('nombre')?.invalid">
            <small>âš ï¸ Nombre obligatorio</small>
          </div>
        </div>

        <div class="form-group">
          <label for="admin-apellido">ğŸ“ Apellido</label>
          <input 
            id="admin-apellido"
            type="text" 
            formControlName="apellido"
            placeholder="Ingrese el apellido"
            [class.error]="nuevoAdminForm.get('apellido')?.touched && nuevoAdminForm.get('apellido')?.invalid">
          <div class="error-messages" *ngIf="nuevoAdminForm.get('apellido')?.touched && nuevoAdminForm.get('apellido')?.invalid">
            <small>âš ï¸ Apellido obligatorio</small>
          </div>
        </div>

        <div class="form-group">
          <label for="admin-edad">ğŸ‚ Edad</label>
          <input 
            id="admin-edad"
            type="number" 
            formControlName="edad"
            placeholder="Edad"
            [class.error]="nuevoAdminForm.get('edad')?.touched && nuevoAdminForm.get('edad')?.invalid">
          <div class="error-messages" *ngIf="nuevoAdminForm.get('edad')?.touched && nuevoAdminForm.get('edad')?.invalid">
            <small>âš ï¸ Edad entre 18 y 120</small>
          </div>
        </div>

        <div class="form-group">
          <label for="admin-dni">ğŸ†” DNI</label>
          <input 
            id="admin-dni"
            type="number" 
            formControlName="dni"
            placeholder="NÃºmero de documento"
            [class.error]="nuevoAdminForm.get('dni')?.touched && nuevoAdminForm.get('dni')?.invalid">
          <div class="error-messages" *ngIf="nuevoAdminForm.get('dni')?.touched && nuevoAdminForm.get('dni')?.invalid">
            <small *ngIf="nuevoAdminForm.get('dni')?.hasError('required')">âš ï¸ DNI obligatorio</small>
            <small *ngIf="nuevoAdminForm.get('dni')?.hasError('dniInvalido')" class="error-dni">
              âŒ El DNI debe tener mÃ¡ximo 8 dÃ­gitos y ser mayor a 0
            </small>
          </div>
        </div>

        <div class="form-group">
          <label for="admin-email">ğŸ“§ Email</label>
          <input 
            id="admin-email"
            type="email" 
            formControlName="email"
            placeholder="correo@ejemplo.com"
            [class.error]="nuevoAdminForm.get('email')?.touched && nuevoAdminForm.get('email')?.invalid">
          <div class="error-messages" *ngIf="nuevoAdminForm.get('email')?.touched && nuevoAdminForm.get('email')?.invalid">
            <small>âš ï¸ Email invÃ¡lido</small>
          </div>
        </div>

        <div class="form-group">
          <label for="admin-password">ğŸ”’ ContraseÃ±a</label>
          <input 
            id="admin-password"
            type="password" 
            formControlName="contraseÃ±a"
            placeholder="MÃ­nimo 6 caracteres"
            [class.error]="nuevoAdminForm.get('contraseÃ±a')?.touched && nuevoAdminForm.get('contraseÃ±a')?.invalid">
          <div class="error-messages" *ngIf="nuevoAdminForm.get('contraseÃ±a')?.touched && nuevoAdminForm.get('contraseÃ±a')?.invalid">
            <small>âš ï¸ ContraseÃ±a mÃ­nima 6 caracteres</small>
          </div>
        </div>

        <div class="form-group file-group">
          <label for="admin-image">ğŸ“¸ Imagen de Perfil</label>
          <input 
            id="admin-image"
            type="file" 
            (change)="subirImagenEmpleado($event, 'administrador')"
            accept="image/*">
          <div class="error-messages" *ngIf="nuevoAdminForm.get('imagenPerfil')?.touched && nuevoAdminForm.get('imagenPerfil')?.invalid">
            <small>âŒ Imagen de perfil obligatoria</small>
          </div>
          <div *ngIf="imagenPreview" class="image-preview">
            <img [src]="imagenPreview" alt="Vista previa" class="preview-img">
            <span class="preview-label">Vista previa</span>
          </div>
        </div>
      </div>

      <button type="submit" class="submit-btn admin-btn" [disabled]="nuevoAdminForm.invalid || loading">
        <span class="btn-icon">ğŸ‘¨â€ğŸ’¼</span>
        <span class="btn-text">Crear Administrador</span>
      </button>
    </form>
  </div>

  <!-- Formulario Nuevo Empleado -->
  <div class="form-section" *ngIf="crearTipo === 'empleado'">
    <div class="form-header">
      <h2 class="form-title">ğŸ‘¨â€âš•ï¸ Crear Nuevo Especialista</h2>
      <p class="form-subtitle">Complete los datos del nuevo especialista mÃ©dico</p>
    </div>
    
    <form [formGroup]="nuevoEmpleadoForm" (ngSubmit)="crearEmpleado()" class="medical-form">
      <div class="form-grid">
        <div class="form-group">
          <label for="emp-nombre">ğŸ‘¤ Nombre</label>
          <input 
            id="emp-nombre"
            type="text" 
            formControlName="nombre"
            placeholder="Ingrese el nombre"
            [class.error]="nuevoEmpleadoForm.get('nombre')?.touched && nuevoEmpleadoForm.get('nombre')?.invalid">
          <div class="error-messages" *ngIf="nuevoEmpleadoForm.get('nombre')?.touched && nuevoEmpleadoForm.get('nombre')?.invalid">
            <small>âš ï¸ Nombre obligatorio</small>
          </div>
        </div>

        <div class="form-group">
          <label for="emp-apellido">ğŸ“ Apellido</label>
          <input 
            id="emp-apellido"
            type="text" 
            formControlName="apellido"
            placeholder="Ingrese el apellido"
            [class.error]="nuevoEmpleadoForm.get('apellido')?.touched && nuevoEmpleadoForm.get('apellido')?.invalid">
          <div class="error-messages" *ngIf="nuevoEmpleadoForm.get('apellido')?.touched && nuevoEmpleadoForm.get('apellido')?.invalid">
            <small>âš ï¸ Apellido obligatorio</small>
          </div>
        </div>

        <div class="form-group">
          <label for="emp-edad">ğŸ‚ Edad</label>
          <input 
            id="emp-edad"
            type="number" 
            formControlName="edad"
            placeholder="Edad"
            [class.error]="nuevoEmpleadoForm.get('edad')?.touched && nuevoEmpleadoForm.get('edad')?.invalid">
          <div class="error-messages" *ngIf="nuevoEmpleadoForm.get('edad')?.touched && nuevoEmpleadoForm.get('edad')?.invalid">
            <small>âš ï¸ Edad debe ser entre 18 y 120</small>
          </div>
        </div>

        <div class="form-group">
          <label for="emp-dni">ğŸ†” DNI</label>
          <input 
            id="emp-dni"
            type="number" 
            formControlName="dni"
            placeholder="NÃºmero de documento"
            [class.error]="nuevoEmpleadoForm.get('dni')?.touched && nuevoEmpleadoForm.get('dni')?.invalid">
          <div class="error-messages" *ngIf="nuevoEmpleadoForm.get('dni')?.touched && nuevoEmpleadoForm.get('dni')?.invalid">
            <small *ngIf="nuevoEmpleadoForm.get('dni')?.hasError('required')">âš ï¸ DNI obligatorio</small>
            <small *ngIf="nuevoEmpleadoForm.get('dni')?.hasError('dniInvalido')" class="error-dni">
              âŒ El DNI debe tener mÃ¡ximo 8 dÃ­gitos y ser mayor a 0
            </small>
          </div>
        </div>

        <div class="form-group">
          <label for="emp-especialidad">ğŸ©º Especialidad</label>
          <input 
            id="emp-especialidad"
            type="text" 
            formControlName="especialidad"
            placeholder="Ej: CardiologÃ­a, NeurologÃ­a..."
            [class.error]="nuevoEmpleadoForm.get('especialidad')?.touched && nuevoEmpleadoForm.get('especialidad')?.invalid">
          <div class="error-messages" *ngIf="nuevoEmpleadoForm.get('especialidad')?.touched && nuevoEmpleadoForm.get('especialidad')?.invalid">
            <small *ngIf="nuevoEmpleadoForm.get('especialidad')?.hasError('required')">âš ï¸ Especialidad obligatoria</small>
            <small *ngIf="nuevoEmpleadoForm.get('especialidad')?.hasError('noAdministrador')" class="error-administrador">
              âŒ No se puede registrar como "administrador". Use el formulario correspondiente.
            </small>
          </div>
        </div>

        <div class="form-group">
          <label for="emp-email">ğŸ“§ Email</label>
          <input 
            id="emp-email"
            type="email" 
            formControlName="email"
            placeholder="correo@ejemplo.com"
            [class.error]="nuevoEmpleadoForm.get('email')?.touched && nuevoEmpleadoForm.get('email')?.invalid">
          <div class="error-messages" *ngIf="nuevoEmpleadoForm.get('email')?.touched && nuevoEmpleadoForm.get('email')?.invalid">
            <small>âš ï¸ Email invÃ¡lido</small>
          </div>
        </div>

        <div class="form-group">
          <label for="emp-password">ğŸ”’ ContraseÃ±a</label>
          <input 
            id="emp-password"
            type="password" 
            formControlName="contraseÃ±a"
            placeholder="MÃ­nimo 6 caracteres"
            [class.error]="nuevoEmpleadoForm.get('contraseÃ±a')?.touched && nuevoEmpleadoForm.get('contraseÃ±a')?.invalid">
          <div class="error-messages" *ngIf="nuevoEmpleadoForm.get('contraseÃ±a')?.touched && nuevoEmpleadoForm.get('contraseÃ±a')?.invalid">
            <small>âš ï¸ ContraseÃ±a mÃ­nima 6 caracteres</small>
          </div>
        </div>

        <div class="form-group file-group">
          <label for="emp-image">ğŸ“¸ Imagen de Perfil</label>
          <input 
            id="emp-image"
            type="file" 
            (change)="subirImagenEmpleado($event, 'empleado')"
            accept="image/*">
          <div class="error-messages" *ngIf="nuevoEmpleadoForm.get('imagenPerfil')?.touched && nuevoEmpleadoForm.get('imagenPerfil')?.invalid">
            <small>âŒ Imagen de perfil obligatoria</small>
          </div>
          <div *ngIf="imagenPreview" class="image-preview">
            <img [src]="imagenPreview" alt="Vista previa" class="preview-img">
            <span class="preview-label">Vista previa</span>
          </div>
        </div>
      </div>

      <button type="submit" class="submit-btn specialist-btn" [disabled]="nuevoEmpleadoForm.invalid || loading">
        <span class="btn-icon">ğŸ‘¨â€âš•ï¸</span>
        <span class="btn-text">Crear Especialista</span>
      </button>
    </form>
  </div>

  <!-- Formulario Nuevo Paciente -->
  <div class="form-section" *ngIf="crearTipo === 'paciente'">
    <div class="form-header">
      <h2 class="form-title">ğŸ‘¤ Crear Nuevo Paciente</h2>
      <p class="form-subtitle">Complete los datos del nuevo paciente</p>
    </div>
    
    <form [formGroup]="nuevoPacienteForm" (ngSubmit)="crearPaciente()" class="medical-form">
      <div class="form-grid">
        <div class="form-group">
          <label for="pac-nombre">ğŸ‘¤ Nombre</label>
          <input 
            id="pac-nombre"
            type="text" 
            formControlName="nombre"
            placeholder="Ingrese el nombre"
            [class.error]="nuevoPacienteForm.get('nombre')?.touched && nuevoPacienteForm.get('nombre')?.invalid">
          <div class="error-messages" *ngIf="nuevoPacienteForm.get('nombre')?.touched && nuevoPacienteForm.get('nombre')?.invalid">
            <small>âš ï¸ Nombre obligatorio</small>
          </div>
        </div>

        <div class="form-group">
          <label for="pac-apellido">ğŸ“ Apellido</label>
          <input 
            id="pac-apellido"
            type="text" 
            formControlName="apellido"
            placeholder="Ingrese el apellido"
            [class.error]="nuevoPacienteForm.get('apellido')?.touched && nuevoPacienteForm.get('apellido')?.invalid">
          <div class="error-messages" *ngIf="nuevoPacienteForm.get('apellido')?.touched && nuevoPacienteForm.get('apellido')?.invalid">
            <small>âš ï¸ Apellido obligatorio</small>
          </div>
        </div>

        <div class="form-group">
          <label for="pac-dni">ğŸ†” DNI</label>
          <input 
            id="pac-dni"
            type="number" 
            formControlName="dni"
            placeholder="NÃºmero de documento"
            [class.error]="nuevoPacienteForm.get('dni')?.touched && nuevoPacienteForm.get('dni')?.invalid">
          <div class="error-messages" *ngIf="nuevoPacienteForm.get('dni')?.touched && nuevoPacienteForm.get('dni')?.invalid">
            <small *ngIf="nuevoPacienteForm.get('dni')?.hasError('required')">âš ï¸ DNI obligatorio</small>
            <small *ngIf="nuevoPacienteForm.get('dni')?.hasError('dniInvalido')" class="error-dni">
              âŒ El DNI debe tener mÃ¡ximo 8 dÃ­gitos y ser mayor a 0
            </small>
          </div>
        </div>

        <div class="form-group">
          <label for="pac-obra-social">ğŸ¥ Obra Social</label>
          <input 
            id="pac-obra-social"
            type="text" 
            formControlName="obraSocial"
            placeholder="Ej: OSDE, Swiss Medical..."
            [class.error]="nuevoPacienteForm.get('obraSocial')?.touched && nuevoPacienteForm.get('obraSocial')?.invalid">
          <div class="error-messages" *ngIf="nuevoPacienteForm.get('obraSocial')?.touched && nuevoPacienteForm.get('obraSocial')?.invalid">
            <small>âš ï¸ Obra Social obligatoria</small>
          </div>
        </div>

        <div class="form-group">
          <label for="pac-email">ğŸ“§ Email</label>
          <input 
            id="pac-email"
            type="email" 
            formControlName="email"
            placeholder="correo@ejemplo.com"
            [class.error]="nuevoPacienteForm.get('email')?.touched && nuevoPacienteForm.get('email')?.invalid">
          <div class="error-messages" *ngIf="nuevoPacienteForm.get('email')?.touched && nuevoPacienteForm.get('email')?.invalid">
            <small>âš ï¸ Email invÃ¡lido</small>
          </div>
        </div>

        <div class="form-group">
          <label for="pac-password">ğŸ”’ ContraseÃ±a</label>
          <input 
            id="pac-password"
            type="password" 
            formControlName="contraseÃ±a"
            placeholder="MÃ­nimo 6 caracteres"
            [class.error]="nuevoPacienteForm.get('contraseÃ±a')?.touched && nuevoPacienteForm.get('contraseÃ±a')?.invalid">
          <div class="error-messages" *ngIf="nuevoPacienteForm.get('contraseÃ±a')?.touched && nuevoPacienteForm.get('contraseÃ±a')?.invalid">
            <small>âš ï¸ ContraseÃ±a mÃ­nima 6 caracteres</small>
          </div>
        </div>

        <div class="form-group file-group">
          <label for="pac-foto1">ğŸ“¸ Foto 1</label>
          <input 
            id="pac-foto1"
            type="file" 
            (change)="subirImagenPaciente($event,'foto1')"
            accept="image/*">
          <div class="error-messages" *ngIf="nuevoPacienteForm.get('foto1')?.touched && nuevoPacienteForm.get('foto1')?.invalid">
            <small>âŒ Primera foto obligatoria</small>
          </div>
        </div>

        <div class="form-group file-group">
          <label for="pac-foto2">ğŸ“¸ Foto 2</label>
          <input 
            id="pac-foto2"
            type="file" 
            (change)="subirImagenPaciente($event,'foto2')"
            accept="image/*">
          <div class="error-messages" *ngIf="nuevoPacienteForm.get('foto2')?.touched && nuevoPacienteForm.get('foto2')?.invalid">
            <small>âŒ Segunda foto obligatoria</small>
          </div>
        </div>
      </div>

      <button type="submit" class="submit-btn patient-btn" [disabled]="nuevoPacienteForm.invalid || loading">
        <span class="btn-icon">ğŸ‘¤</span>
        <span class="btn-text">Crear Paciente</span>
      </button>
    </form>
  </div>

  <!-- Overlay con Spinner Material -->
  <div class="overlay" *ngIf="loading">
    <mat-progress-spinner 
      mode="indeterminate" 
      color="primary" 
      diameter="60" 
      strokeWidth="5">
    </mat-progress-spinner>
  </div>

</div>
